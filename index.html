<!DOCTYPE html>
<html>

<head>
    <title>Doâ€˜kon</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>

<body>

    <h2>ðŸ›’ Doâ€˜kon</h2>
    <div id="products"></div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        fetch("../api/products.php")
            .then(res => res.json())
            .then(data => {
                data.products.forEach(p => {
                    document.getElementById("products").innerHTML += `
        <div>
          <h3>${p.name}</h3>
          <p>${p.description}</p>
          <b>${p.price} ball</b>
          <button onclick="buy(${p.id})">Sotib olish</button>
        </div>
      `;
                });
            });

        function buy(product_id) {
            fetch("../api/buy.php", {
                method: "POST",
                body: new URLSearchParams({
                    user_id: tg.initDataUnsafe.user.id,
                    product_id
                })
            })
                .then(res => res.json())
                .then(r => alert(r.msg));
        }

    </script>
</body>

</html>
