<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Do'kon</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4">
    <h1 class="text-2xl font-bold mb-4">Do'kon</h1>
    
    <div class="mb-8">
        <h2 class="text-xl mb-2">Narsalar</h2>
        <div class="grid grid-cols-1 gap-4">
            {% for item in items %}
            <div class="bg-white p-4 rounded shadow">
                <img src="{{ item[3] }}" alt="{{ item[1] }}" class="w-full h-48 object-cover mb-2">
                <h3 class="font-bold">{{ item[1] }}</h3>
                <p>{{ item[2] }}</p>
                <p>Narx: {{ item[4] }} ball</p>
                <button onclick="buyItem({{ item[0] }})" class="bg-blue-500 text-white px-4 py-2 rounded">Sotib olish</button>
            </div>
            {% endfor %}
        </div>
    </div>
    
    <div>
        <h2 class="text-xl mb-2">Oldingi sotib olganlar</h2>
        <ul class="list-disc pl-4">
            {% for trans in transactions %}
            <li>{{ trans[0] }} - {{ trans[1] }}</li>
            {% endfor %}
        </ul>
    </div>
    
    <script>
        // Get user_id from Telegram
        const userId = window.Telegram.WebApp.initDataUnsafe.user.id;
        
        function buyItem(itemId) {
            fetch('/buy', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({user_id: userId, item_id: itemId})
            }).then(res => res.json()).then(data => {
                if (data.success) alert('Sotib olindi!');
                else alert('Ball yetarli emas!');
                location.reload();
            });
        }
    </script>
</body>
</html>